<% provide(:title, "Index") %>
<h1>All tasks</h1>
<% if @tasks.present? %>
  <%= will_paginate %>
  <table class = "table table-bordered width-table90">
    <thead>
      <tr>
        <th>Name</th>
        <th>Short description</th>
        <th>Kind</th>
        <th>Task master</th>
        <th>Task assignee</th>
        <th>Status</th>
        <th>Process</th>
        <th>Deadline</th>
      </tr>
    </thead>
    <tbody>
      <% @tasks.each do |task| %>
        <% if task.due_date.present? %>
          <% if Time.now > task.due_date && !task.task_finish? %>
            <tr class="red-background">
          <% else %>
            <% if task.due_date - Time.now < 3600 && !task.task_finish?%>
              <tr class="yellow-background">
            <% else %>
              <tr>
            <% end %>
          <% end %>
        <% else %>
          <tr>
        <% end %>
          <% if @farm %>
            <td><%= link_to task.name, user_farm_task_path(@user, @farm, task) %></td>
          <% else %>
            <td><%= link_to task.name, user_task_path(@user,task) %></td>
          <% end %>
          <td><%= task.short_description %></td>
          <td><%= task.kind %></td>
          <td><%= task.master.full_name %></td>
          <td><%= task.assignee.full_name if task.assignee.present? %></td>
          <td><%= task.status %></td>
          <td>
            <% if task.process < 50 %>
              <%= progress_bar(task.process, color: "blue", :rounded => true, :tiny => true) unless task.status == "Open" %>
            <% else %>
              <%= progress_bar(task.process, color: "orange", :rounded => true, :tiny => true) %>
            <% end %>
          </td>
          <td>
            <%= task.due_date %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <%= will_paginate %>
<% else %>
  <h3>We don't have any tasks </h3>
<% end %>